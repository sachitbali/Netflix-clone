name: netflix
on:
    push:
        branches:
            - main
env:
    AWS_REGION: ap-southeast-2
jobs:
    Testing:
        runs-on: ubuntu-latest
        steps:
            - name: code checkout
              uses: actions/checkout@v4
            
            - name: setup node.js
              uses: actions/setup-node@v4
              with:
                node-version: '16'
            - name: install dependency
              run: npm install 
    SONAR_ANALYSIS:
        runs-on: ubuntu-latest
        steps:
            - name: set java 11
              uses: actions/setup-java@v4
              with:
                distribution: 'temurin'
                java-version: '11'

            - name: setup sonarqube
              uses: warchant/setup-sonar-scanner@v7

            - name: sonqrqube scan
              run: sonar-scanner
                -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }}
                -Dsonar.login=${{ secrets.SONAR_TOKEN }}
                -Dsonar.organization=${{ secrets.SONAR_ORGANIZATION }}
                -Dsonar.projectKey=${{ secrets.SONAR_PROJECT_KEY }}
                -Dsonar.sources=src/
    File_scan:
        needs: SONAR_ANALYSIS
        runs-on: ubuntu-latest
        steps:
            - name: install trivy
              run: |
                trivy fs  . > trivy.txt


    